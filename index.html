<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      canvas {
        background-color: #466078;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <div id="out"></div>
    <script src="jquery.min.js"></script>
    <script src="kinetic-v4.5.3.min.js"></script>
    <script defer="defer">
      var stage = new Kinetic.Stage({
        container: 'container',
        width: 700,
        height: 400
      });

      var layer = new Kinetic.Layer();

      var canvas = $('body').attr('tabindex', 0);
      var keys = {};



      var move = 3;

//animation
ancho_caminar = 70;
alto_sprite = 110;
var feyFrames = [
        //idle 0 1 2 3 4 5 6 7 8 9 10
        {
          x: 0,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 105,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 210,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 315,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 420,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 525,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 630,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 735,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 840,
          y: 265,
          width: 105,
          height: alto_sprite
        }, {
          x: 945,
          y: 265,
          width: 105,
          height: alto_sprite
        },
        //punch 10 11
        {
          x: 10,
          y: 1800,
          width: 105,
          height: alto_sprite
        }, {
          x: 105,
          y: 1800,
          width: 135,
          height: alto_sprite
        },
        //move 12 13 14 15 16 17 18
        {
          x: 0,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar*2,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar*3,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar*4,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar*5,
          y: 735,
          width: ancho_caminar,
          height: alto_sprite
        }, {
          x: ancho_caminar*6,
          y: 735,
          width: 55,
          height: alto_sprite
        }, {
          x: ancho_caminar*6+55,
          y: 735,
          width: 55,
          height: alto_sprite
        }
        ];
      var animations = {
        idle: [feyFrames[0],
        feyFrames[1],
        feyFrames[2],
        feyFrames[3],
        feyFrames[4],
        feyFrames[5],
        feyFrames[6],
        feyFrames[7],
        feyFrames[8],
        feyFrames[9]],
        punch: [feyFrames[10],
        feyFrames[11],
        feyFrames[10]],
        move:[feyFrames[12],
        feyFrames[13],
        feyFrames[14],
        feyFrames[15],
        feyFrames[16],
        feyFrames[17],
        feyFrames[18],
        feyFrames[19]
        ]
      };
      var imageObj = new Image();
      var blob = new Kinetic.Sprite({
        x: 250,
        y: 40,
        image: imageObj,
        animation: 'idle',
        animations: animations,
        frameRate: 9,
        index: 0
      });
      imageObj.onload = function() {

        // add the shape to the layer
        layer.add(blob);

        // add the layer to the stage
        stage.add(layer);

        // start sprite animation
        blob.start();
         $('canvas').css('background-color', '#408080');

      };
      imageObj.src = 'SFA3PS_FeiLong.PNG';

      

//listener
      var anim = new Kinetic.Animation(function(frame) {
        var x = blob.getAttr('x');
        var y = blob.getAttr('y');
        for (var i in keys) {
            if (!keys.hasOwnProperty(i)) continue;
            if(i==37){
              x -= move;
              if(x<-100){
                x = 700;
              }
            }else if(i==39){
              x += move;
              if(x>700){
                x= -100;
              }
            }
            if(i==38){
              y -= move;
              if(y<-50){
                y = 400;
              }
            }else if(i==40){
              y += move;
              if(y>400){
                y = -50;
              }
            }
          }
        blob.setAttrs({'x':x, 'y':y});
      }, layer);

      anim.start();

      $(document).keydown(function (e) {
        if(e.which==32 && !keys[32]){
          blob.setAnimation('punch');
          blob.afterFrame(2, function() {
            blob.setAnimation('idle');
          });
        }
        if((e.which==37 && !keys[37])|| 
           (e.which==38 && !keys[38])||
           (e.which==39 && !keys[39])||
           (e.which==40 && !keys[40])){
          blob.setAnimation('move');
        }
        keys[e.which] = true;
      });

      $(document).keyup(function (e) {
        if((e.which==37 && keys[37])|| 
           (e.which==38 && keys[38])||
           (e.which==39 && keys[39])||
           (e.which==40 && keys[40])){
            blob.setAnimation('idle');
          }
          delete keys[e.which];
      });


    </script>
  </body>
</html>